<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¯”å–»å¥æŒ‘æˆ° 3.1</title>
    <style>
        :root {
            --primary-color: #007bff;
            --primary-dark: #0056b3;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --light-bg: #f0f7ff;
            --dark-text: #343a40;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Heiti TC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: var(--light-bg);
            color: var(--dark-text);
            text-align: center;
            padding: 20px 0;
        }
        .container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 700px;
        }
        h1 {
            color: var(--primary-dark);
            margin-bottom: 15px;
        }
        p {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 25px;
        }
        .btn {
            padding: 15px 30px;
            font-size: 1.3em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            transition: all 0.3s ease;
        }
        .btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
        }
        
        /* Screens */
        #game-screen, #end-screen {
            display: none;
        }

        /* Game Screen */
        #game-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
        }
        #score-display { color: var(--primary-color); }
        
        #lives-container {
            display: flex;
            gap: 5px;
        }
        .heart-icon {
            width: 28px;
            height: 28px;
            fill: var(--danger-color);
            transition: fill 0.5s ease;
        }
        .heart-icon.lost {
            fill: #ccc;
        }

        #timer-container {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }
        #timer-bar {
            height: 100%;
            width: 100%;
            background-color: var(--success-color);
            border-radius: 10px;
            transition: width 0.1s linear, background-color 0.5s;
        }

        #sentence-box {
            font-size: 1.7em;
            font-weight: bold;
            line-height: 1.6;
            margin: 25px 0;
            padding: 25px;
            background-color: #e9f5ff;
            border-radius: 10px;
            border-left: 6px solid var(--primary-color);
            min-height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #004a8f;
        }
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }
        .option-btn {
            padding: 15px 20px;
            font-size: 1.2em;
            font-weight: bold;
            border: 2px solid var(--primary-color);
            border-radius: 10px;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
        }
        .option-btn:hover:not(:disabled) {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
        }
        .option-btn:disabled {
            background-color: #a0a0a0;
            border-color: #a0a0a0;
            cursor: not-allowed;
            opacity: 0.7;
        }

        #feedback-container {
            margin-top: 25px;
            padding: 15px;
            border-radius: 10px;
            min-height: 50px;
        }
        #feedback {
            font-size: 1.4em;
            font-weight: bold;
        }
        .correct { color: var(--success-color); }
        .incorrect { color: var(--danger-color); }

        #explanation-box {
            display: none;
            margin-top: 15px;
            padding: 20px;
            background-color: var(--dark-text);
            color: #ffffff;
            border-radius: 10px;
            font-size: 1.1em;
            line-height: 1.7;
            text-align: left;
        }

        /* End Screen */
        #history-log {
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            text-align: left;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 10px;
        }
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .history-item:last-child {
            border-bottom: none;
        }
        .history-item p {
            margin: 5px 0;
            font-size: 1em;
        }
    </style>
</head>
<body>

    <!-- Start Screen -->
    <div id="start-screen" class="container">
        <h1>æ¯”å–»å¥æŒ‘æˆ° 3.1 ğŸ§</h1>
        <p>æº–å‚™å¥½æ¸¬è©¦ä½ çš„èªæ–‡èƒ½åŠ›äº†å—ï¼Ÿ<br>åœ¨æ™‚é–“å…§å¿«é€Ÿä½œç­”ï¼Œçˆ­å–æœ€é«˜åˆ†å§ï¼</p>
        <button id="start-btn" class="btn">é–‹å§‹éŠæˆ²</button>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="container">
        <div id="game-stats">
            <span id="question-counter">å•é¡Œ 1/20</span>
            <span id="score-display">åˆ†æ•¸: 0</span>
            <div id="lives-container">
                <svg class="heart-icon" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                <svg class="heart-icon" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                <svg class="heart-icon" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            </div>
        </div>
        <div id="timer-container">
            <div id="timer-bar"></div>
        </div>
        <div id="sentence-box">...</div>
        <div class="options">
            <button class="option-btn" onclick="checkAnswer('æ˜å–»')">æ˜å–»</button>
            <button class="option-btn" onclick="checkAnswer('æš—å–»')">æš—å–»</button>
            <button class="option-btn" onclick="checkAnswer('å€Ÿå–»')">å€Ÿå–»</button>
        </div>
        <div id="feedback-container">
            <div id="feedback"></div>
            <div id="explanation-box"></div>
        </div>
    </div>

    <!-- End Screen -->
    <div id="end-screen" class="container">
        <h1>éŠæˆ²çµæŸï¼</h1>
        <p style="font-size: 1.5em; font-weight: bold;">ä½ çš„æœ€çµ‚åˆ†æ•¸æ˜¯: <span id="final-score">0</span></p>
        <h2>ç­”é¡Œè¨˜éŒ„</h2>
        <div id="history-log"></div>
        <button id="restart-btn" class="btn" style="margin-top: 20px;">é‡æ–°æŒ‘æˆ°</button>
    </div>

    <script>
        const questions = [
            // æ˜å–» (Simile) x10
            { sentence: 'å¤©ä¸Šçš„é›²æœµåƒè»Ÿç¶¿ç¶¿çš„æ£‰èŠ±ç³–ã€‚', type: 'æ˜å–»', explanation: 'é€™å¥æ˜¯ã€Œæ˜å–»ã€ï¼Œå› ç‚ºå¥å­ç”¨æ¯”å–»è©ã€Œåƒã€å­—ï¼Œæ¸…æ¥šåœ°æŠŠã€Œé›²æœµã€(æœ¬é«”) æ¯”å–»æˆã€Œæ£‰èŠ±ç³–ã€(å–»é«”)ã€‚' },
            { sentence: 'åœ“åœ“çš„æœˆäº®å¥½åƒä¸€å€‹éŠ€è‰²çš„ç›¤å­ã€‚', type: 'æ˜å–»', explanation: 'é€™å¥æ˜¯ã€Œæ˜å–»ã€ï¼Œå› ç‚ºå¥å­ç”¨æ¯”å–»è©ã€Œå¥½åƒã€ï¼ŒæŠŠã€Œæœˆäº®ã€(æœ¬é«”) æ¯”å–»æˆã€ŒéŠ€è‰²çš„ç›¤å­ã€(å–»é«”)ã€‚' },
            { sentence: 'çˆ¸çˆ¸çš„æ„›å¦‚åŒä¸€åº§å±±ï¼Œåšå¯¦è€Œå¯é ã€‚', type: 'æ˜å–»', explanation: 'é€™å¥æ˜¯ã€Œæ˜å–»ã€ï¼Œå› ç‚ºå¥å­ç”¨æ¯”å–»è©ã€Œå¦‚åŒã€ï¼ŒæŠŠã€Œçˆ¸çˆ¸çš„æ„›ã€(æœ¬é«”) æ¯”å–»æˆã€Œå±±ã€(å–»é«”)ã€‚' },
            { sentence: 'æ¹–æ°´æ¸…æ¾ˆå¾—å½·å½¿ä¸€é¢é¡å­ã€‚', type: 'æ˜å–»', explanation: 'é€™å¥æ˜¯ã€Œæ˜å–»ã€ï¼Œå› ç‚ºå¥å­ç”¨æ¯”å–»è©ã€Œå½·å½¿ã€ï¼ŒæŠŠã€Œæ¹–æ°´ã€(æœ¬é«”) æ¯”å–»æˆã€Œé¡å­ã€(å–»é«”)ã€‚' },
            { sentence: 'å¦¹å¦¹çš„è‡‰è›‹ç´…å¾—å¥½ä¼¼è˜‹æœã€‚', type: 'æ˜å–»', explanation: 'é€™å¥æ˜¯ã€Œæ˜å–»ã€ï¼Œå› ç‚ºå¥å­ç”¨æ¯”å–»è©ã€Œå¥½ä¼¼ã€ï¼ŒæŠŠã€Œå¦¹å¦¹çš„è‡‰è›‹ã€(æœ¬é«”) æ¯”å–»æˆã€Œè˜‹æœã€(å–»é«”)ã€‚' },
            { sentence: 'è¡—ä¸Šçš„ç‡ˆå…‰æœ‰å¦‚é–ƒçˆçš„æ˜Ÿæ˜Ÿã€‚', type: 'æ˜å–»', explanation: 'é€™å¥æ˜¯ã€Œæ˜å–»ã€ï¼Œå› ç‚ºå¥å­ç”¨æ¯”å–»è©ã€Œæœ‰å¦‚ã€ï¼ŒæŠŠã€Œè¡—ä¸Šçš„ç‡ˆå…‰ã€(æœ¬é«”) æ¯”å–»æˆã€Œæ˜Ÿæ˜Ÿã€(å–»é«”)ã€‚' },
            { sentence: 'ç€‘å¸ƒçš„è²éŸ³å½·å½¿åƒè»è¬é¦¬åœ¨å¥”é¨°ã€‚', type: 'æ˜å–»', explanation: 'é€™å¥æ˜¯ã€Œæ˜å–»ã€ï¼Œå› ç‚ºå¥å­ç”¨æ¯”å–»è©ã€Œå½·å½¿ã€ï¼ŒæŠŠã€Œç€‘å¸ƒçš„è²éŸ³ã€(æœ¬é«”) æ¯”å–»æˆã€Œåƒè»è¬é¦¬ã€(å–»é«”)ã€‚' },
            { sentence: 'é€™æœ¬æ›¸çš„å…§å®¹å°±åƒä¸€åº§çŸ¥è­˜çš„å¯¶åº«ã€‚', type: 'æ˜å–»', explanation: 'é€™å¥æ˜¯ã€Œæ˜å–»ã€ï¼Œå› ç‚ºå¥å­ç”¨æ¯”å–»è©ã€Œå°±åƒã€ï¼ŒæŠŠã€Œæ›¸çš„å…§å®¹ã€(æœ¬é«”) æ¯”å–»æˆã€ŒçŸ¥è­˜çš„å¯¶åº«ã€(å–»é«”)ã€‚' },
            { sentence: 'ä»–çš„æ‰‹è‡‚å£¯å¾—è·Ÿä¸€æ ¹æŸ±å­ä¼¼çš„ã€‚', type: 'æ˜å–»', explanation: 'é€™å¥æ˜¯ã€Œæ˜å–»ã€ï¼Œå› ç‚ºå¥å­ç”¨æ¯”å–»è©ã€Œä¼¼çš„ã€ï¼ŒæŠŠã€Œä»–çš„æ‰‹è‡‚ã€(æœ¬é«”) æ¯”å–»æˆã€ŒæŸ±å­ã€(å–»é«”)ã€‚' },
            { sentence: 'è€å¸«çš„è©±èªå¦‚æ˜¥é¢¨ä¸€èˆ¬æº«æš–æˆ‘å€‘çš„å¿ƒã€‚', type: 'æ˜å–»', explanation: 'é€™å¥æ˜¯ã€Œæ˜å–»ã€ï¼Œå› ç‚ºå¥å­ç”¨æ¯”å–»è©ã€Œå¦‚ã€ï¼ŒæŠŠã€Œè€å¸«çš„è©±èªã€(æœ¬é«”) æ¯”å–»æˆã€Œæ˜¥é¢¨ã€(å–»é«”)ã€‚' },
            // æš—å–» (Metaphor) x10
            { sentence: 'é¦¬è·¯æ˜¯ä¸€æ¢é•·é•·çš„æ²³æµï¼Œè»Šå­æ˜¯æ²³è£¡çš„é­šå…’ã€‚', type: 'æš—å–»', explanation: 'é€™å¥æ˜¯ã€Œæš—å–»ã€ï¼Œå› ç‚ºå¥å­æ²’æœ‰ç”¨æ¯”å–»è©ï¼Œè€Œæ˜¯ç›´æ¥æ–·å®šã€Œé¦¬è·¯ã€(æœ¬é«”) å°±æ˜¯ã€Œæ²³æµã€(å–»é«”)ã€‚' },
            { sentence: 'æ™‚é–“æ˜¯ç„¡æƒ…çš„å°å·ï¼Œæ‚„æ‚„åœ°å·èµ°æˆ‘å€‘çš„æ­²æœˆã€‚', type: 'æš—å–»', explanation: 'é€™å¥æ˜¯ã€Œæš—å–»ã€ï¼Œå› ç‚ºå¥å­ç›´æ¥æŠŠã€Œæ™‚é–“ã€(æœ¬é«”) èªªæˆæ˜¯ã€Œå°å·ã€(å–»é«”)ï¼Œæœ‰ã€ŒAæ˜¯Bã€çš„æ ¼å¼ã€‚' },
            { sentence: 'å¦¹å¦¹æ˜¯æˆ‘å€‘å®¶çš„é–‹å¿ƒæœã€‚', type: 'æš—å–»', explanation: 'é€™å¥æ˜¯ã€Œæš—å–»ã€ï¼Œå› ç‚ºå¥å­ç›´æ¥æŠŠã€Œå¦¹å¦¹ã€(æœ¬é«”) èªªæˆæ˜¯ã€Œé–‹å¿ƒæœã€(å–»é«”)ï¼Œè¡¨é”å¥¹å¸¶ä¾†æ­¡æ¨‚çš„ç‰¹è³ªã€‚' },
            { sentence: 'é‚£åº§é«˜å±±æ˜¯å®ˆè­·è‘—é€™ç‰‡åœŸåœ°çš„å·¨äººã€‚', type: 'æš—å–»', explanation: 'é€™å¥æ˜¯ã€Œæš—å–»ã€ï¼Œå› ç‚ºå¥å­ç›´æ¥æ–·å®šã€Œé«˜å±±ã€(æœ¬é«”) å°±æ˜¯ã€Œå·¨äººã€(å–»ä½“)ï¼Œå½¢å®¹å…¶é›„å‰ã€‚' },
            { sentence: 'å‹¤å¥®æ˜¯é€šå¾€æˆåŠŸçš„éšæ¢¯ã€‚', type: 'æš—å–»', explanation: 'é€™å¥æ˜¯ã€Œæš—å–»ã€ï¼Œå› ç‚ºå¥å­ç›´æ¥æŠŠã€Œå‹¤å¥®ã€(æœ¬é«”) èªªæˆæ˜¯ã€Œéšæ¢¯ã€(å–»é«”)ã€‚' },
            { sentence: 'é›»è…¦æ˜¯ç¾ä»£äººä¸å¯æˆ–ç¼ºçš„å¤§è…¦ã€‚', type: 'æš—å–»', explanation: 'é€™å¥æ˜¯ã€Œæš—å–»ã€ï¼Œå› ç‚ºå¥å­ç›´æ¥æ–·å®šã€Œé›»è…¦ã€(æœ¬é«”) å°±æ˜¯ã€Œå¤§è…¦ã€(å–»é«”)ï¼Œå¼·èª¿å…¶è™•ç†è³‡è¨Šçš„åŠŸèƒ½ã€‚' },
            { sentence: 'å­©å­å€‘æ˜¯åœ‹å®¶æœªä¾†çš„ä¸»äººç¿ã€‚', type: 'æš—å–»', explanation: 'é€™å¥æ˜¯ã€Œæš—å–»ã€ï¼Œå› ç‚ºå¥å­ç›´æ¥æŠŠã€Œå­©å­å€‘ã€(æœ¬é«”) èªªæˆæ˜¯ã€Œä¸»äººç¿ã€(å–»é«”)ã€‚' },
            { sentence: 'å¯¬å®¹æ˜¯äººèˆ‡äººä¹‹é–“æœ€ç¾çš„æ©‹æ¨‘ã€‚', type: 'æš—å–»', explanation: 'é€™å¥æ˜¯ã€Œæš—å–»ã€ï¼Œå› ç‚ºå¥å­ç›´æ¥æŠŠã€Œå¯¬å®¹ã€(æœ¬é«”) èªªæˆæ˜¯ã€Œæ©‹æ¨‘ã€(å–»é«”)ã€‚' },
            { sentence: 'ä¸€æœ¬å¥½æ›¸ï¼Œå°±æ˜¯ä¸€ä½è‰¯å¸«ç›Šå‹ã€‚', type: 'æš—å–»', explanation: 'é€™å¥æ˜¯ã€Œæš—å–»ã€ï¼Œå› ç‚ºå¥å­ç›´æ¥æ–·å®šã€Œå¥½æ›¸ã€(æœ¬é«”) å°±æ˜¯ã€Œè‰¯å¸«ç›Šå‹ã€(å–»é«”)ã€‚' },
            { sentence: 'æŒ«æŠ˜æ˜¯ç£¨ç·´æ„å¿—çš„ç¤ªçŸ³ã€‚', type: 'æš—å–»', explanation: 'é€™å¥æ˜¯ã€Œæš—å–»ã€ï¼Œå› ç‚ºå¥å­ç›´æ¥æŠŠã€ŒæŒ«æŠ˜ã€(æœ¬é«”) èªªæˆæ˜¯ã€Œç¤ªçŸ³ã€(å–»é«”)ï¼Œå¼·èª¿å…¶ç£¨ç·´çš„ä½œç”¨ã€‚' },
            // å€Ÿå–» (Implied Metaphor) x10
            { sentence: 'ç§‹é¢¨æƒéï¼Œåœ°ä¸Šé‹ªæ»¿äº†é‡‘è‰²çš„åœ°æ¯¯ã€‚', type: 'å€Ÿå–»', explanation: 'é€™å¥æ˜¯ã€Œå€Ÿå–»ã€ï¼Œå› ç‚ºå¥å­ä¸­ã€Œæœ¬é«”ã€(è½è‘‰)æ²’æœ‰å‡ºç¾ï¼Œåªç”¨ã€Œé‡‘è‰²çš„åœ°æ¯¯ã€(å–»é«”) ä¾†ä»£æ›¿æ»¿åœ°çš„è½è‘‰ã€‚' },
            { sentence: 'çƒé›²å¯†ä½ˆï¼Œå¤©ç©ºçš„è‡‰è‰²æ²‰äº†ä¸‹ä¾†ã€‚', type: 'å€Ÿå–»', explanation: 'é€™å¥æ˜¯ã€Œå€Ÿå–»ã€ï¼Œå› ç‚ºå¥å­ä¸­ã€Œæœ¬é«”ã€(å¤©ç©ºçš„æ™¯è±¡)æ²’æœ‰å‡ºç¾ï¼Œè€Œæ˜¯ç›´æ¥å€Ÿç”¨äººçš„ã€Œè‡‰è‰²ã€(å–»é«”) ä¾†å½¢å®¹ã€‚' },
            { sentence: 'ä¸€ä¸²ä¸²ç†Ÿé€çš„çç æ›åœ¨è—¤ä¸Šï¼Œæ™¶ç‘©å‰”é€ã€‚', type: 'å€Ÿå–»', explanation: 'é€™å¥æ˜¯ã€Œå€Ÿå–»ã€ï¼Œå› ç‚ºå¥å­ä¸­ã€Œæœ¬é«”ã€(è‘¡è„)æ²’æœ‰å‡ºç¾ï¼Œåªç”¨ã€Œçç ã€(å–»é«”) ä¾†ä»£æ›¿å®ƒã€‚' },
            { sentence: 'ä»–å¿ƒä¸­çš„é‚£åœ˜ç«ï¼Œå› ç‚ºä¸€å¥é¼“å‹µè€Œé‡æ–°ç‡ƒç‡’ã€‚', type: 'å€Ÿå–»', explanation: 'é€™å¥æ˜¯ã€Œå€Ÿå–»ã€ï¼Œå› ç‚ºå¥å­ä¸­ã€Œæœ¬é«”ã€(ç†±æƒ…æˆ–å¸Œæœ›)æ²’æœ‰å‡ºç¾ï¼Œåªç”¨ã€Œç«ã€(å–»é«”) ä¾†ä»£æ›¿ã€‚' },
            { sentence: 'å¤œç©ºä¸­ç‘æ»¿äº†ç¢é‘½ã€‚', type: 'å€Ÿå–»', explanation: 'é€™å¥æ˜¯ã€Œå€Ÿå–»ã€ï¼Œå› ç‚ºå¥å­ä¸­ã€Œæœ¬é«”ã€(æ˜Ÿæ˜Ÿ)æ²’æœ‰å‡ºç¾ï¼Œåªç”¨ã€Œç¢é‘½ã€(å–»é«”) ä¾†ä»£æ›¿æ»¿å¤©æ˜Ÿå…‰ã€‚' },
            { sentence: 'æˆ‘å€‘è¦å°å¿ƒæé˜²ç¤¾æœƒä¸Šçš„æ¯’è‰ã€‚', type: 'å€Ÿå–»', explanation: 'é€™å¥æ˜¯ã€Œå€Ÿå–»ã€ï¼Œå› ç‚ºå¥å­ä¸­ã€Œæœ¬é«”ã€(ä¸è‰¯æ€æƒ³æˆ–å£äºº)æ²’æœ‰å‡ºç¾ï¼Œåªç”¨ã€Œæ¯’è‰ã€(å–»é«”) ä¾†ä»£æ›¿ã€‚' },
            { sentence: 'é€™éš»è€ç‹ç‹¸åˆåœ¨æ‰“ä»€éº¼é¬¼ä¸»æ„ï¼Ÿ', type: 'å€Ÿå–»', explanation: 'é€™å¥æ˜¯ã€Œå€Ÿå–»ã€ï¼Œå› ç‚ºå¥å­ä¸­ã€Œæœ¬é«”ã€(ç‹¡çŒ¾çš„äºº)æ²’æœ‰å‡ºç¾ï¼Œåªç”¨ã€Œè€ç‹ç‹¸ã€(å–»é«”) ä¾†ä»£æ›¿ã€‚' },
            { sentence: 'æ¯è¦ªçš„å˜®å¨ï¼Œæ˜¯å¤æ—¥è£¡çš„ä¸€é™£æ¶¼é¢¨ã€‚', type: 'å€Ÿå–»', explanation: 'é€™å¥æ˜¯ã€Œå€Ÿå–»ã€ï¼Œã€Œæœ¬é«”ã€(é—œæ‡·)æ²’æœ‰å‡ºç¾ï¼Œç›´æ¥ç”¨ã€Œå¤æ—¥çš„æ¶¼é¢¨ã€(å–»é«”)ä¾†å½¢å®¹æ¯è¦ªçš„å˜®å¨æ‰€å¸¶ä¾†çš„æ•ˆæœã€‚' },
            { sentence: 'çª—å¤–çš„éœ“è™¹ï¼Œç‚ºé€™åŸå¸‚ç©¿ä¸Šäº†è¯éº—çš„æ™šè£ã€‚', type: 'å€Ÿå–»', explanation: 'é€™å¥æ˜¯ã€Œå€Ÿå–»ã€ï¼Œã€Œæœ¬é«”ã€(åŸå¸‚çš„å¤œæ™¯)æ²’æœ‰å‡ºç¾ï¼Œç›´æ¥ç”¨ã€Œè¯éº—çš„æ™šè£ã€(å–»é«”)ä¾†å½¢å®¹ã€‚' },
            { sentence: 'åˆ¥çœ‹ä»–å¹³æ™‚æ²‰é»˜ï¼Œéª¨å­è£¡æ˜¯é ­çŒ›è™ã€‚', type: 'å€Ÿå–»', explanation: 'é€™å¥æ˜¯ã€Œå€Ÿå–»ã€ï¼Œã€Œæœ¬é«”ã€(å‹‡çŒ›çš„æ€§æ ¼)æ²’æœ‰å‡ºç¾ï¼Œç›´æ¥ç”¨ã€ŒçŒ›è™ã€(å–»é«”)ä¾†å½¢å®¹ä»–å…§åœ¨çš„å€‹æ€§ã€‚' },
        ];

        // DOM Elements
        const startScreen = document.getElementById('start-screen');
        const gameScreen = document.getElementById('game-screen');
        const endScreen = document.getElementById('end-screen');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const sentenceBox = document.getElementById('sentence-box');
        const feedback = document.getElementById('feedback');
        const explanationBox = document.getElementById('explanation-box');
        const optionButtons = document.querySelectorAll('.option-btn');
        const scoreDisplay = document.getElementById('score-display');
        const livesContainer = document.getElementById('lives-container');
        const questionCounter = document.getElementById('question-counter');
        const timerBar = document.getElementById('timer-bar');
        const finalScoreDisplay = document.getElementById('final-score');
        const historyLog = document.getElementById('history-log');

        // Game State
        let unaskedQuestions = [];
        let currentQuestion = {};
        let score = 0;
        let wrongAnswers = 0;
        let questionNumber = 0;
        let gameHistory = [];
        let timerInterval;
        let timeRemaining;
        let currentTimerDuration;

        // Game Config
        const MAX_WRONG_ANSWERS = 3;
        const MAX_QUESTIONS = 20;
        const INITIAL_TIMER_DURATION = 15000; // 15 seconds
        const MIN_TIMER_DURATION = 5000; // 5 seconds
        const TIMER_DECREMENT = 500; // 0.5 seconds
        const DELAY_CORRECT = 3000;
        const DELAY_INCORRECT = 7000;

        function init() {
            startBtn.addEventListener('click', startGame);
            restartBtn.addEventListener('click', () => {
                endScreen.style.display = 'none';
                startScreen.style.display = 'block';
            });
        }

        function startGame() {
            // Reset state
            score = 0;
            wrongAnswers = 0;
            questionNumber = 0;
            gameHistory = [];
            currentTimerDuration = INITIAL_TIMER_DURATION;
            unaskedQuestions = [...questions];

            // Reset UI
            document.querySelectorAll('.heart-icon').forEach(heart => {
                heart.classList.remove('lost');
            });
            startScreen.style.display = 'none';
            gameScreen.style.display = 'block';
            
            loadQuestion();
        }

        function loadQuestion() {
            if (wrongAnswers >= MAX_WRONG_ANSWERS || questionNumber >= MAX_QUESTIONS) {
                endGame();
                return;
            }

            questionNumber++;

            // Reset UI for next question
            feedback.textContent = '';
            feedback.className = '';
            explanationBox.style.display = 'none';
            optionButtons.forEach(btn => btn.disabled = false);
            updateStats();
            
            // Get new question
            const randomIndex = Math.floor(Math.random() * unaskedQuestions.length);
            currentQuestion = unaskedQuestions.splice(randomIndex, 1)[0];
            sentenceBox.textContent = currentQuestion.sentence;

            // Start timer
            startTimer();
        }
        
        function startTimer() {
            clearInterval(timerInterval);
            timeRemaining = currentTimerDuration;
            timerBar.style.transition = 'none'; // Reset transition for instant width change
            timerBar.style.width = '100%';
            timerBar.style.backgroundColor = 'var(--success-color)';
            
            // Force reflow to apply the reset width instantly
            void timerBar.offsetWidth; 
            
            timerBar.style.transition = `width ${currentTimerDuration / 1000}s linear, background-color 0.5s`;
            timerBar.style.width = '0%';

            timerInterval = setInterval(() => {
                timeRemaining -= 100;
                if(timeRemaining < currentTimerDuration * 0.25) timerBar.style.backgroundColor = 'var(--danger-color)';
                else if(timeRemaining < currentTimerDuration * 0.5) timerBar.style.backgroundColor = '#ffc107';

                if (timeRemaining <= 0) {
                    checkAnswer(null); // Time's up
                }
            }, 100);
        }

        function checkAnswer(userAnswer) {
            clearInterval(timerInterval);
            // Freeze the timer bar visually
            const computedStyle = window.getComputedStyle(timerBar);
            const currentWidth = computedStyle.getPropertyValue('width');
            timerBar.style.transition = 'none';
            timerBar.style.width = currentWidth;

            optionButtons.forEach(btn => btn.disabled = true);

            let wasCorrect = userAnswer === currentQuestion.type;
            let pointsEarned = 0;

            if (wasCorrect) {
                feedback.textContent = 'ç­”å°äº†ï¼ä½ çœŸæ£’ï¼ğŸ˜„';
                feedback.className = 'correct';
                
                const timePercentage = timeRemaining / currentTimerDuration;
                if (timePercentage > 0.75) pointsEarned = 20;
                else if (timePercentage > 0.50) pointsEarned = 15;
                else if (timePercentage > 0.25) pointsEarned = 10;
                else pointsEarned = 5;
                score += pointsEarned;

            } else {
                wrongAnswers++;
                const hearts = document.querySelectorAll('.heart-icon');
                if (hearts[wrongAnswers - 1]) {
                    hearts[wrongAnswers - 1].classList.add('lost');
                }
                feedback.textContent = userAnswer === null ? 'æ™‚é–“åˆ°ï¼' : 'ç­”éŒ¯äº†...';
                feedback.innerHTML += ` æ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œ${currentQuestion.type}ã€ã€‚`;
                feedback.className = 'incorrect';
            }
            
            explanationBox.textContent = currentQuestion.explanation;
            explanationBox.style.display = 'block';

            gameHistory.push({
                question: currentQuestion.sentence,
                userAnswer: userAnswer || 'æœªä½œç­”',
                correctAnswer: currentQuestion.type,
                wasCorrect: wasCorrect,
                explanation: currentQuestion.explanation
            });
            
            updateStats();

            // Decrease timer for next round, with a minimum
            if (currentTimerDuration > MIN_TIMER_DURATION) {
                currentTimerDuration -= TIMER_DECREMENT;
            }

            setTimeout(loadQuestion, wasCorrect ? DELAY_CORRECT : DELAY_INCORRECT);
        }

        function updateStats() {
            scoreDisplay.textContent = `åˆ†æ•¸: ${score}`;
            questionCounter.textContent = `å•é¡Œ ${questionNumber}/${MAX_QUESTIONS}`;
        }
        
        function endGame() {
            gameScreen.style.display = 'none';
            endScreen.style.display = 'block';
            finalScoreDisplay.textContent = score;
            renderHistory();
        }

        function renderHistory() {
            historyLog.innerHTML = '';
            gameHistory.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'history-item';
                itemDiv.innerHTML = `
                    <p><strong>é¡Œç›®:</strong> ${item.question}</p>
                    <p style="color: ${item.wasCorrect ? 'var(--success-color)' : 'var(--danger-color)'}"><strong>ä½ çš„ç­”æ¡ˆ:</strong> ${item.userAnswer}</p>
                    <p><strong>æ­£ç¢ºç­”æ¡ˆ:</strong> ${item.correctAnswer}</p>
                    <p><strong>åŸå› :</strong> ${item.explanation}</p>
                `;
                historyLog.appendChild(itemDiv);
            });
        }

        init();
    </script>

</body>
</html>

